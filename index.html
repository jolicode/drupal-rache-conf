<!doctype html>
<html lang="fr">
    <head>
        <meta charset="utf-8">

        <title>Drupal au secours de la méthode R.A.C.H.E</title>

        <meta name="description" content="Drupal au secours de la méthode R.A.C.H.E - La gestion de projet *live* avec Drupal">
        <meta name="author" content="JoliCode">
        <!-- Powered by the awesome http://lab.hakim.se/reveal-js/ -->

        <meta name="apple-mobile-web-app-capable" content="yes" />
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

        <link rel="stylesheet" href="css/reveal.min.css">
        <link rel="stylesheet" href="css/theme/jolicode.css" id="theme">

        <!-- Some more styles not part of the theme -->
        <style type="text/css">
            .keepcalm .reveal {
                background-color: #E31F17;
            }

            .troll .reveal {
                background-image: url('images/troll.png');
                background-repeat: no-repeat;
                background-position: 110% 10%;
                background-size: 25%;
            }

            .spacecat .reveal {
                background-image: url('images/spacecat.jpg');
                background-size: cover;
            }

            .keyboard-help img {
                height: 1em;
                vertical-align: text-top;
                margin: 0!important;
                margin-left: 20px!important;
            }
            .keyboard-help kbd {
                color: #797979;
                border: 1px solid #414141;
                padding: 0 2px;
            }
            .keyboard-help {
                margin-top: 50px!important;
            }
        </style>

        <!-- For syntax highlighting -->
        <link rel="stylesheet" href="lib/css/zenburn.css">

        <!-- If the query includes 'print-pdf', use the PDF print sheet -->
        <script>
            document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
        </script>

        <!--[if lt IE 9]>
        <script src="lib/js/html5shiv.js"></script>
        <![endif]-->
    </head>

    <body>

        <div class="reveal">
            <div class="slides">

                <section>
                    <h1>Drupal au secours de la méthode R.A.C.H.E</h1>
                    <!-- <h4>(autrement dit… Drupal en gestion de projet "live")</h4> -->

                    <p class="footnote">(autrement dit… Drupal en gestion de projet "live")</p>
                </section>

                <section data-state="jolistate">
                    <h2>Bastien Jaillot</h2>

                    <p>
                        <a href="https://twitter.com/bastnic">
                            <img src="images/chouette.jpg" alt="Bastien Jaillot"
                                 style="width: 30%; vertical-align: middle; background-color: white; padding: 10px;border-radius: 15px" />
                        </a>
                    </p>

                    <p>
                    Je suis <del>fainéant</del> <strong>pragmatique</strong> ಠ_ಠ
                    </p>
                </section>

                <section data-state="jolistate">
                    <p>
                        <a href="http://jolicode.com">
                            <img src="./lib/font/logo-fond-noir.svg" alt="JoliCode" />
                        </a>
                    </p>

                    <h2>Conseil, réalisation, audit, expertise et formation</h2>

                    <p class="footnote">
                        ...Poney, Guinness et gif animé.
                    </p>
                </section>

                <section>
                    <p><img src="images/Strips-Hackaton-550-final.jpg" alt=""></p>
                    <p class="footnote">Source : <a href="http://www.commitstrip.com/fr/2012/09/18/cest-toujours-une-histoire-de-contexte/">http://www.commitstrip.com/fr/2012/09/18/cest-toujours-une-histoire-de-contexte/</a>
                </section>

                <section>
                    <h2>Le niveau de motivation</h2>
                    <ul style="display: inline-block; width: 44%; margin-right: 3%; ">
                        <li><strong>Pour un projet client</strong></li>
                        <li>Le CP : vous avez cinq jours pour la BETA, ça va le faire hein ?</li>
                        <li>Dev 1 : Tu rigoles ? C'est beaucoup trop court</li>
                        <li>DT : Prévois au moins 8 jours</li>
                    </ul>
                    <ul style="display: inline-block; width: 44%; vertical-align: top;">
                        <li><strong>Pour un projet d'Hackaton</strong></li>
                        <li>Le CP : bon les gars, il reste 24h, vous pensez que c'est jouable ? ?</li>
                        <li>Dev 1 : T'inquiètes</li>
                        <li>Dev 2 : Facile !</li>
                        <li>DT : Largement</li>
                    </ul>

                </section>

                <section>
                    <h2>Pré-requis</h2>

                    <ul>
                        <li>Être un <a href="http://gyshido.com/">GyShiDo-San</a> (cf slide suivante)</li>
                        <li>Être fainéant</li>
                        <li>Être curieux</li>
                        <li>Connaître l'écosystème Drupal</li>
                        <li>Découvrir / Apprendre en permanence</li>
                        <li>Partager</li>
                    </ul>
                </section>

                <section>
                    <h2>GyShiDo-San ?</h2>
                    <p>L'art de "Getting your Shit Done" !</p>
                    <ul>
                        <li>Relentless Focus</li>
                        <li>Boring Consistency</li>
                        <li>No Bullshit</li>
                        <li>No Meetings</li>
                        <li>Follow Up</li>
                        <li>Don't be an Asshole</li>
                    </ul>
                    <p class="footnote"><a href="http://gyshido.com/">GyShiDo - The Art of Getting Shit Done. http://gyshido.com/</a></p>
                </section>

                <section>
                    <h2>Méthode R.A.C.H.E</h2>

                    <p>Qui-que-quoi-où-quand-comment-pourquoi ?</p>
                    <p><a href="http://www.la-rache.com/">http://www.la-rache.com/</a></p>
                </section>

                <section>
                    <h2>R.A.C.H.E ?</h2>
                    <ul>
                        <li><strong>R</strong>apid</li>
                        <li><strong>A</strong>pplication</li>
                        <li><strong>C</strong>onception and</li>
                        <li><strong>H</strong>euristic</li>
                        <li><strong>E</strong>xtreme-programming</li>
                    </ul>
                    <p class="footnote"><a href="http://www.la-rache.com/">http://www.la-rache.com/</a></p>
                </section>

                <section>
                    <h2>Cycle typique d'utilisation de la R.A.C.H.E</h2>
                    <img src="images/cycle-rache.jpg" alt="">
                    <p class="footnote"><a href="http://www.la-rache.com/">http://www.la-rache.com/</a></p>
                </section>

                <section>
                    <blockquote>If you don't care about bugs, design or scalability, it only takes 2 days to build anything</blockquote>
                    <p class="footnote"><a href="https://twitter.com/polotek/status/312673667484106752">https://twitter.com/polotek/status/312673667484106752</a></p>
                </section>

                <section>
                    <h3>Une méthode pour des projets <strong>sans</strong> gestion de projet</h3>
                </section>

                <section>
                    <p>Essayons de faire <strong>mieux</strong>,<br> dans la <strong>même durée</strong></p>
                </section>

                <section>
                    <h3>Le projet : plateforme de participation citoyenne</h3>
                    <ul>
                        <li>Projet de cinq citoyens</li>
                        <li>Deux experts Web (Simon Perdrisat <a href="http://twitter.com/gagarine">@gagarine</a> et moi)</li>
                        <li>Serveur dédié à disposition</li>
                        <li>Liberté d'utiliser des briques logicielles… fun (K/V store, (lucene) index, message queuing, asynchrone, near-realtime computing)</li>
                        <li><a href="https://www.parlement-et-citoyens.fr">https://www.parlement-et-citoyens.fr</a></li>
                    </ul>
                </section>

                <section>
                    <h3>Le projet : plateforme de participation citoyenne</h3>
                    <ul>
                        <li>Très très peu de temps </li>
                        <li>Risque d'engranger beaucoup de données (cool, cool, cool)</li>
                        <li>Aucune idée de l'avenir du projet ? (à j+1) : LIVE!</li>
                        <li>Et donc… très très peu de temps</li>
                        <li><a href="https://www.parlement-et-citoyens.fr">https://www.parlement-et-citoyens.fr</a></li>
                    </ul>
                </section>

                <section>
                    <h3>Le projet : plateforme de participation citoyenne</h3>
                    <p>n défi fonctionnel et humain plus qu'un défi technique<br>
                    Ne laissez pas la technique ralentir le projet.</p>
                </section>

                <section>
                    <h3>En savoir plus sur le projet</h3>
                    <blockquote>Utilisez vos connaissances pour construire (ensemble) un monde meilleur</blockquote>
                    <p class="footnote"><a href="http://jolicode.github.com/opengov-conf">http://jolicode.github.com/opengov-conf</a></p>
                </section>

                <section>
                    <section>
                        <h2>Étape 0 : réduction du périmètre</h2>
                        <p>Toujours, encore, … et encore !</p>
                    </section>
                    <section>
                        <p>Rappel : on ne sait pas comment le site va évoluer, pourquoi prédire ? Mettons nous en situation de réaction efficace</p>
                        <p>Donc réduction du périmètre par 4, plein de pages prétenduement dynamique => statique + text filter </p>
                    </section>
                </section>

                <section>
                    <h2>Étape 1 : DDSD</h2>
                    <p><strong>D</strong>ata <strong>D</strong>riven <strong>S</strong>cript <strong>D</strong>evelopment</p>
                </section>

                <section>
                    <h3>DDSD – étape 1.1</h3>
                    <ul>
                    <li>Contenu (structuré, mais encore inconnu) sur lequel on peut intéragir</li>
                    <li>Implémentation d'une méthodologie conçue en trois ans par un non-informaticien</li>
                    </ul>
                </section>

                <section>
                    <img src="images/schema.png" alt="">
                </section>

                <section>
                    <section>
                        <img src="images/schema-avis.png" alt="">
                    </section>
                    <section>
                        <h3>DDSD – étape 1</h3>
                        <p>Ce qu'on a obtenu au final</p>
                        <ul>
                            <li>Enquête : node</li>
                            <li>Élément d'enquêtes : entity (eck)</li>
                            <li>Arborescence d'élément d'enquêtes : entity (eck)</li>
                            <li>Source : entity (eck)</li>
                            <li>Intérêt de la source : entity (eck)</li>
                            <li>Avis : entity (eck)</li>
                            <li>Élément d'avis : entity (eck)</li>
                            <li>le tout relié dans tous les sens par entityreference</li>
                        </ul>
                    </section>
                </section>




                <section>
                    <section>
                        <h3>DDSD – étape 1</h3>
                        <ul>
                            <li>Contenu trop complexe à contribuer
                                <ul>
                                    <li>Pas le temps de préparer une UI</li>
                                    <li>Fixtures + script pour importer</li>
                                </ul>
                            </li>
                        </ul>
                    </section>

                    <section>
                        <h3>DDSD – sous le capot</h3>
                        <ul>
                            <li><a href="https://github.com/symfony/Yaml/">loader Yaml (Symfony Component)</a></li>
                            <li>Drush</li>
                            <li>yaml file (one per enquete)</li>
                            <li>Merci <a href="http://drupalcontrib.org/api/drupal/contributions%21entity%21includes%21entity.property.inc/function/entity_property_values_create_entity/7">entity_property_values_create_entity</a></li>
                        </ul>
                    </section>
                </section>


<!--                 <section>
                    <h3>DDSD – étape 1</h3>
                    <ul>
                    <li>un tel niveau de contenu est trop complexe pour "simplement" contribuer</li>
                    <li>prévu : multiple entity_inline_form avec eck (=> à l'époque ça n'était pas
                    possible, ça l'est devenu)</li>
                    <li>nous n'avions aucune idée de comment le contenu évoluerait, si les
                    visiteurs contribueront, de la qualité du contenu, tout ça</li>
                    </ul>
                </section> -->

                <section>
                    <h3>Jusque-là, un symfony serait bien meilleur et plus efficace</h3>

                    <ul>
<!--                     <li>mais rappelez vous la courbe de progression. La motivation est facile au début du projet.
                    Avec un framework il faut développer toute la suite, avec Drupal, des dizaines de
                    milliers de modules à disposition pour ajouter du fonctionnel (forum, intégrations sociales,
                    contenu)</li> -->
                    <li>Mais… les contributeurs doivent pouvoir faire vivre le site sans aide technique</li>
                    </ul>
                </section>

                <section>
                    <h3>Ainsi…</h3>
                    <img src="images/cycle-rache-drupal-framework.jpg" alt="">
                </section>

                <section>
                    <h3>Développements prévus != développements effectués</h3>
                    <p>Exemple : pas encore de gestion de la poubelle : aucun spam, contenu injurieux reçu (qui l'eût cru !)</p>
                </section>


                <section>
                    <h2>Quelques exemples supra utiles</h2>
                    <ul>
                        <li>Cache</li>
                        <li>Entity Construction Kit (ECK)</li>
                        <li>Voting API</li>
                        <li>Search API</li>
                        <!-- <li>Entity References + contrib</li> -->
                    </ul>
                </section>

                <section>
                    <section>
                        <h2>Gestion du cache</h2>
                        <p>Éviter les optimisations préventives, tout en sachant que c'est facile de mettre en place après</p>
</p>
                        <ol>
                            <li>Cache de base en bases de données</li>
                            <li>Utilisation de Search API</li>
                            <li>Ajout d'<a href="https://drupal.org/project/entitycache">Entity Cache</a></li>
                            <li>Invalidation + regénération événementielle du cache</li>
                            <li>Pré-calcul de plein de choses dans Entity Cache</li>
                            <li>Utilisation de <a href="http://redis.io/">redis</a></li>
                        </ol>
                    </section>

                    <section>
                        <pre><code data-trim>
/**
 * Implements hook_entity_load().
 *
 * Will be CACHED in redis once for all
 */
function smg_concertation_entity_load($entities, $type) {
  if ($type == SOMETHING_INTERESTING) {
    $something = make_a_big_calcul($entities);

    foreach ($entities as $entity) {
      $entity->precalculated_value = $something[$entity->id];
    }
  }
}
                        </code></pre>
                    </section>

                    <section>
                        <h3>Sont pré-calculées</h3>
                        <!-- <p></p> -->
                        <ul>
                            <li>tous les compteurs</li>
                            <li>liaisons avec les comptes utilisateurs (logo, nom, etc.)</li>
                            <li>permalink (liens vers une recherche à facette)</li>
                            <li>sous items pré-fetchés</li>
                            <li>vote activé ou pas</li>
                        </ul>
                    </section>
                </section>

                <section>
                    <h2>Module ECK</h2>
                    <ul>
                        <li>UI pour créer des entités / bundle / configurer champs</li>
                        <li>Exportable</li>
                        <li>Mais des manques, <strong>comblés depuis</strong> :
                            <ul>
                                <li>Pas de cache sur les propriétés des entités / bundle => patch commité (<a href="http://drupal.org/node/1914746">#1914746</a>)</li>
                                <li>Pas d'intégration avec entitycache => nouveau module ok (<a href="http://drupal.org/node/1506468">#1506468</a>)</li>
                                <li>Pas d'intégration avec Inline Entity Form => patch commité (<a href="http://drupal.org/node/1689726">#1689726</a>)</li>
                            </ul>
                        </li>
                    </ul>
                </section>

                <section>
                    <h2>Module Search API et consorts</h2>
                    <ul>
                        <li>Dénormalisation du contenu</li>
                        <li>Workflow, facettes, &hearts;</li>
                        <li>Quelques ajouts :
                            <ul>
                                <li>Exposition de nouvelles données pré-calculées</li>
                                <li>Utilisation stockage DB puis Solr</li>
                            </ul>
                        </li>
                    </ul>
                </section>

                <section>
                    <section>
                        <h2>Module Voting API et consorts</h2>
                        <ul>
                            <li>Gestion du cache</li>
                            <li>Plusieurs widgets</li>
                            <li>Mais des manques, <strong>comblés depuis</strong> :
                                <ul>
                                    <li>is_useful, bonne logique mais mauvais rendu => surcharge js</li>
                                    <li>trois requêtes sql par entité affichée. J'en avais >200 par page à cause de mon contenu arborescent, surcharge du formatter (ou patch, me rappelle plus)</li>
                                    <li>un form généré pour chaque affichage => surcharge du formattter pour uniquement afficher les données quand pas authentifié</li>
                                </ul>
                            </li>
                        </ul>
                    </section>


                    <section>
                        <pre><code data-trim>
// hook_field_prepare_view take an array of entity,
// not one entity

// override formatter
function smg_voting_field_formatter_info() {
  return array(
    'smg_voting_formatter_default' => array(
      'label' => t('SMG Voting Default'),
      'field types' => array('is_useful'),
    ),
  );
}
                        </code></pre>
                    </section>
                    <section>
                        <pre><code data-trim>
/**
 * Implementation of hook_field_formatter_view().
 */
function smg_voting_field_formatter_view($entity_type, $entity, $field, $instance, $langcode, $items, $display) {
  if (!user_is_logged_in()) { // should be a permission check ;)
    return 'blabla html';
  }

  // some code
  $element[0] = drupal_get_form('is_useful_exposed_formatter', $settings);
  return $element;
}
                        </code></pre>
                    </section>
                </section>

                <section>
                    <h2>Quelques astuces supplémentaires</h2>
                    <ul>
                        <li>Utilisation de <a href="http://mandrill.com/">Mandrill</a> pour envoyer les mails transactionnels (<a href="http://drupal.org/project/mandrill">module</a>)</li>
                        <li>Thème basé sur <a href="http://drupal.org/project/mothership">mothership</a> + <a href="http://twitter.github.com/bootstrap/">Twitter bootstrap</a> pour un thème propre, simple et passe partout</li>
                        <li>Page d'accueil = un node blindé d'html + ouput filter (même pas honte)</li>
                        <li><a href="http://drupal.org/project/community_tags">Community tags</a> intégré avec des entities (patch à nettoyer et à proposer)</li>
                    </ul>
                </section>

                <section>
                    <h2>Et des bonus</h2>
                   <ul>
                        <li>Backup automatique avec Drush</li>
                        <li>Tout est rejouable (features, script)</li>
                        <li>Multi-site dès le départ</li>
                        <li>… un CMS complet à disposition !</li>
                    </ul>
                </section>

                <section>
                    <h2>Ce que je ferais au prochain projet</h2>

                    <ul>
                    <li>Configurer tout le serveur avec Chef</p>
                    <li>Inclure dès le départ une logique de statistiques => statsd + graphite
                    (ou un service équivalent : datadog)</li>

                    </ul>
                </section>

                <section>
                    <h2>Configuration serveur et déploiement avec Chef</h2>
                    <ul>
                        <li>Logiciel de gestion de configuration, gestion de rôles, recettes, déploiement, environnement.</li>
                        <li>Automatisation, industrialisation facile à utiliser</li>
                        <li><a href="http://www.opscode.com/chef/">http://www.opscode.com/chef/</a></li>
                    </ul>
                </section>

                <section>
                    <section>
                        <h2>Dashboard applicatif</h2>
                        <p><img src="images/datadog-live.png" alt=""></p>
                    </section>
                    <section>
                        <h3>Exemple des métriques</h3>
                        <ul>
                            <li>nombre d'erreurs 404 / 500</li>
                            <li>temps de génération des pages</li>
                            <li>nombre de pages en cache / générées from scratch</li>
                            <li>nombre d'utilisateurs</li>
                            <li>nombre de blocs générés</li>
                        </ul>
                    </section>
                    <section>
                        <pre><code data-trim>
// # Exemples d'API

StatsD::increment('opengov.action.vote');

StatsD::timing('opengov.page.render', $time);

StatsD::gauge('opengov.count.users', $count);

                        </code></pre>
                    </section>
                </section>

                <section>
                    <h2>Aggrégation de data : StatsD + Datadog</h2>

                    <ul>
                    <li>Gratuit avec un jour de rétention et intégré avec Chef</li>
                    <li>$15 / mois par serveur pour un an de rétention + gestion des alertes</li>
                    <li>Encore mieux : New Relic</li>
                    <li>Stack serveur open source existe, mais en R.A.C.H.E, on ne passe pas
                    plus de 10mn à mettre en place un service !</li>

                    </ul>
                </section>

                <section>
                    <h2>Extrapolation aux projets de tous les jours ?</h2>
                </section>

                <section>
                    <blockquote>Build it, release it, analyse it and only then decide if it needs optimising.</blockquote>
                    <p class="footnote"><a href="https://medium.com/i-m-h-o/eef96ea6f4cb">https://medium.com/i-m-h-o/eef96ea6f4cb</a></p>
                </section>

                <section>
                    <blockquote>L’Agilité c’est : comment travailler dans l’incertitude et dans l’ignorance (celle des évolutions technologiques, des clients, des marchés, etc.).</blockquote>
                    <p class="footnote"><a href="http://www.christian-faure.net/2013/05/25/critique-des-demarches-agiles/">Christian Fauré – Critique des démarches agiles</a></p>
                </section>

                <section>
                    <p>Attention à la <a href="http://letrainde13h37.fr/20/apprehender-notion-dette-technique/">dette technique</a></p>
                </section>

                <section>
                    <blockquote>un début de projet en mode R.A.C.H.E. ?<br> "un démarrache"</blockquote>
                    <p class="footnote"><a href="http://twitter.com/brunobord/status/337120241811333120">http://twitter.com/brunobord/status/337120241811333120</a></p>
                </section>

                <section data-state="jolistate">

                    <img src="images/love.gif" alt="Love you all!" style="width: 80%"/>

                    <p>
                        Bastien Jaillot / @bastnic<br />
                        coucou@jolicode.com
                    </p>

                    <p><a href="http://jolicode.github.io/drupal-methode-rache">http://jolicode.github.io/drupal-methode-rache</a></p>

                    <p class="footnote">PS : on recrute ♥</p>

                </section>
            </div>

        </div>

        <footer class="joli">
            Drupal au secours de la méthode R.A.C.H.E - Drupal Meetup Paris Mai 2013 - <a href="http://jolicode.com/"><img src="./lib/font/logo-fond-noir.svg" alt="JoliCode" height="16px" style="vertical-align: middle" /></a> - Bastien Jaillot
        </footer>

        <script src="lib/js/head.min.js"></script>
        <script src="js/reveal.min.js"></script>

        <script>

            // Full list of configuration options available here:
            // https://github.com/hakimel/reveal.js#configuration
            Reveal.initialize({
                controls: true,
                progress: true,
                history: true,
                center: true,

                theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
                transition: Reveal.getQueryHash().transition || 'none', // default/cube/page/concave/zoom/linear/fade/none

                // Optional libraries used to extend on reveal.js
                dependencies: [
                    { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
                    { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
                    { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
                    { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
                    { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
                    // { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
                    // { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
                ]
            });

        </script>

    </body>
</html>
<!-- plop -->
